# チケット #005: 勘定科目管理サービス

## ステータス
- [x] 完了

## 機能概要
勘定科目のCRUD操作、コード重複チェック、タイプ別検索機能を提供するサービスクラス。
会社ごとの勘定科目管理を行い、ビジネスロジックを実装。

## 実装ファイル

### backend/src/main/java/com/accounting/app/service/
- [x] `AccountService.java`

### 必要なDTOファイル（追加作成が必要な場合）
- AccountRequest.java（作成済み）
- AccountResponse.java（作成済み）

## 主要メソッド

### `List<AccountResponse> findAll(Long companyId)`
- 指定会社のすべての勘定科目を取得
- コード順でソート
- エンティティをレスポンスDTOに変換して返却

### `AccountResponse findById(Long id)`
- IDで勘定科目を検索
- 見つからない場合は`ResourceNotFoundException`をスロー
- レスポンスDTOに変換して返却

### `AccountResponse create(Long companyId, AccountRequest request)`
- 新規勘定科目を作成
- コードの重複チェック（同一会社内）
- 重複がある場合は`BadRequestException`をスロー
- 作成後、レスポンスDTOに変換して返却

### `AccountResponse update(Long id, AccountRequest request)`
- 既存勘定科目を更新
- 存在確認（見つからない場合は`ResourceNotFoundException`）
- コード変更時は重複チェック
- システム勘定科目（isSystem = true）の場合、更新制限を検討
- 更新後、レスポンスDTOに変換して返却

### `void delete(Long id)`
- 勘定科目を削除
- 存在確認（見つからない場合は`ResourceNotFoundException`）
- システム勘定科目の削除は禁止（`BusinessException`をスロー）
- 仕訳明細で使用されている場合は削除禁止（`BusinessException`をスロー）

### `List<AccountResponse> findByAccountType(Long companyId, AccountType type)`
- 指定会社の指定タイプの勘定科目を取得
- コード順でソート
- レスポンスDTOに変換して返却

## ビジネスルール

### コード重複チェック
- 同一会社内でコードが重複しないこと
- 新規作成時と更新時にチェック

### システム勘定科目の保護
- `isSystem = true`の勘定科目は削除不可
- 更新時も制限を検討（コードや勘定科目タイプの変更を禁止）

### 参照整合性チェック
- 削除時、仕訳明細で使用されているかチェック
- 使用されている場合は削除を拒否

### 勘定科目タイプの検証
- AccountTypeは以下の5種類のみ許可:
  - ASSET（資産）
  - LIABILITY（負債）
  - EQUITY（純資産）
  - REVENUE（収益）
  - EXPENSE（費用）

## 依存関係
- `AccountRepository`
- `JournalDetailRepository`（削除時の参照チェック用）
- `CompanyRepository`（会社存在確認用）

## 実装のポイント
- `@Service`アノテーションを付与
- `@Transactional`でトランザクション管理
- リポジトリの戻り値（Optional）を適切にハンドリング
- エンティティ ↔ DTO変換は専用メソッドで実施

## テスト観点
- 正常系: CRUD操作が正しく動作すること
- 異常系: コード重複時にエラーがスローされること
- 異常系: 存在しないIDでの操作時にエラーがスローされること
- 異常系: システム勘定科目の削除時にエラーがスローされること
- 異常系: 使用中の勘定科目の削除時にエラーがスローされること
