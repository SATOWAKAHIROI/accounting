# チケット #004: 例外ハンドリングの実装

## ステータス
- [x] 完了

## 機能概要
カスタム例外クラスとグローバル例外ハンドラーの作成。
アプリケーション全体で統一的なエラーハンドリングを実現し、適切なHTTPステータスコードとエラーメッセージをクライアントに返す。

## 実装ファイル

### backend/src/main/java/com/accounting/app/exception/
- [x] `ResourceNotFoundException.java` - リソース未検出例外
- [x] `BadRequestException.java` - 不正リクエスト例外
- [x] `BusinessException.java` - ビジネスロジック例外
- [x] `UnauthorizedException.java` - 認証エラー例外
- [x] `ForbiddenException.java` - 権限エラー例外
- [x] `GlobalExceptionHandler.java` - グローバル例外ハンドラー

## 主要な実装内容

### カスタム例外クラス

**ResourceNotFoundException**
- リソースが見つからない場合にスロー
- HTTPステータス: 404 Not Found
- エラーコード: `RESOURCE_NOT_FOUND`
- 使用例: `throw new ResourceNotFoundException("Account", "id", accountId);`

**BadRequestException**
- 不正なリクエストの場合にスロー
- HTTPステータス: 400 Bad Request
- エラーコード: `BAD_REQUEST`
- 使用例: `throw new BadRequestException("無効な勘定科目コードです");`

**BusinessException**
- ビジネスロジック違反の場合にスロー
- HTTPステータス: 400 Bad Request
- エラーコード: カスタマイズ可能（デフォルト: `BUSINESS_ERROR`）
- 使用例: `throw new BusinessException("DEBIT_CREDIT_MISMATCH", "借方と貸方の合計が一致しません");`

**UnauthorizedException**
- 認証が必要な場合にスロー
- HTTPステータス: 401 Unauthorized
- エラーコード: `UNAUTHORIZED`
- 使用例: `throw new UnauthorizedException("ログインが必要です");`

**ForbiddenException**
- 権限が不足している場合にスロー
- HTTPステータス: 403 Forbidden
- エラーコード: `FORBIDDEN`
- 使用例: `throw new ForbiddenException("この操作を実行する権限がありません");`

### GlobalExceptionHandler

`@RestControllerAdvice`を使用して、すべてのコントローラで発生した例外を統一的に処理。

**処理する例外**:
1. `ResourceNotFoundException` → 404レスポンス
2. `BadRequestException` → 400レスポンス
3. `BusinessException` → 400レスポンス
4. `UnauthorizedException` → 401レスポンス
5. `ForbiddenException` → 403レスポンス
6. `MethodArgumentNotValidException` → 400レスポンス（バリデーションエラー）
7. `Exception` → 500レスポンス（その他のエラー）

**エラーレスポンス形式**:
```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "ERROR_CODE",
    "message": "エラーメッセージ",
    "details": { ... }  // オプション
  }
}
```

### バリデーションエラーハンドリング

`@Valid`アノテーションによるバリデーションエラーをキャッチし、フィールドごとのエラーメッセージを返す：
```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力値が不正です",
    "details": {
      "code": "コードは必須です",
      "name": "名前は必須です"
    }
  }
}
```

## 備考
- すべての例外クラスは`RuntimeException`を継承
- グローバル例外ハンドラーにより、コントローラでのtry-catchが不要
- エラーログは`Exception`のハンドラーで`printStackTrace()`により出力（本番環境ではロガーを使用推奨）
- エラーコードは定数化することを推奨
