# チケット #011: 請求書管理サービス

## ステータス
- [x] 完了

## 機能概要
請求書のCRUD操作、ステータス管理、PDF生成を提供するサービスクラス。

## 実装ファイル
- [x] `service/InvoiceService.java`
- [x] `dto/request/InvoiceRequest.java`（新規作成）
- [x] `dto/request/InvoiceDetailRequest.java`（新規作成）
- [x] `dto/response/InvoiceResponse.java`（新規作成）
- [x] `dto/response/InvoiceDetailResponse.java`（新規作成）

## 主要メソッド
- `List<InvoiceResponse> findAll(Long companyId)` - 全件取得
- `InvoiceResponse findById(Long id)` - ID検索
- `InvoiceResponse create(Long companyId, InvoiceRequest request)` - 作成
- `InvoiceResponse update(Long id, InvoiceRequest request)` - 更新
- `void delete(Long id)` - 削除
- `InvoiceResponse updateStatus(Long id, InvoiceStatus status)` - ステータス更新
- `byte[] generatePdf(Long id)` - PDF生成

## ビジネスルール
- ステータス遷移: DRAFT → ISSUED → PAID or CANCELED
- 不正な遷移を防止（PAID → DRAFTは不可など）
- 小計・税額・合計の自動計算
  - 小計 = Σ(数量 × 単価)
  - 税額 = Σ(数量 × 単価 × 税率)
  - 合計 = 小計 + 税額
- ISSUED以降のステータスでは編集不可
- 請求番号の重複チェック

## PDF生成
- Apache PDFBoxを使用
- 請求書ヘッダー情報（請求番号、日付、取引先情報）
- 明細テーブル（品目、数量、単価、金額）
- 合計金額

## 依存関係
- InvoiceRepository
- InvoiceDetailRepository
- PartnerRepository
- ItemRepository
- TaxTypeRepository
